<!DOCTYPE html><html lang="en" data-astro-cid-sckkx6r4> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.0.3"><title>GopherHack</title><link rel="stylesheet" href="/_astro/poster.B_Cpo-Oc.css">
<link rel="stylesheet" href="/_astro/_name_.B51i_3Fs.css">
<link rel="stylesheet" href="/_astro/_post_.Dsfu0bp3.css">
<link rel="stylesheet" href="/_astro/image.CVYE6UPY.css"></head> <body data-astro-cid-sckkx6r4> <section class="mainSection" data-astro-cid-sckkx6r4> <div class="content" data-astro-cid-sckkx6r4> <header data-astro-cid-sckkx6r4> <div data-astro-cid-sckkx6r4> <!-- left --> <a href="/" id="logo" data-astro-cid-sckkx6r4>
&#x1F6A9; GopherHack</a> </div> <div data-astro-cid-sckkx6r4> <!-- right --> <div class="links" data-astro-cid-sckkx6r4> <a href="/pages/contests" data-astro-cid-sckkx6r4>Contests</a> <a href="/pages/blog" data-astro-cid-sckkx6r4>Blog</a> <a href="/pages/resources" data-astro-cid-sckkx6r4>Resources</a> <a href="/pages/officers" data-astro-cid-sckkx6r4>Officers</a> </div> <div class="buttons" data-astro-cid-sckkx6r4></div> </div> </header> <main data-astro-cid-sckkx6r4>  <h1 data-astro-cid-quoef3qp>  Nullcon Goa HackIM 2025 CTF: Coinflip </h1> <div class="metadata" data-astro-cid-quoef3qp> <div title="2025-02-02T09:26:39.091Z" data-astro-cid-quoef3qp> Sunday, February 2, 2025 </div> <div data-astro-cid-quoef3qp>
Authored by <a href="/authors/dajeff">dajeff</a> </div> <div data-astro-cid-quoef3qp>
CTF:  <a href="/pages/contests#ctftime-2642" data-astro-cid-quoef3qp> Nullcon Goa HackIM 2025 CTF </a> </div> <div data-astro-cid-quoef3qp>Tags: crypto</div> </div> <div class="postContent" data-astro-cid-quoef3qp> <link rel="stylesheet" href="/_astro/styles.DHdN6dA9.css"/>
<h3 id="problem-summary">Problem Summary</h3>
<blockquote>
<p>Dr. Evil wants to play a game and he demands one <del>million</del> billion shitcoins for the flag.</p>
<div><p><code>52.59.124.14:5032</code></p></div>
<div><a class="btn" href="/_astro/chall.Cp_U05bb.py">chall.py</a></div>
</blockquote>
<p><a class="btn" href="/_astro/chall.Cp_U05bb.py">chall.py</a> contains a pseudo-RNG <code>CRG</code> that randomly generates</p>
<ul>
<li>a 64-bit modulus <code>self.m</code></li>
<li>a relatively prime parameter <code>self.a</code>, and</li>
<li>a relatively prime initial state <code>self.state</code>.</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">def</span><span style="color:#79B8FF"> __init__</span><span style="color:#E1E4E8">(self, n):</span></span>
<span class="line"><span style="color:#9ECBFF">    &#39;&#39;&#39;n - bitlength of state&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#79B8FF">    self</span><span style="color:#E1E4E8">.n </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> n</span></span>
<span class="line"><span style="color:#79B8FF">    self</span><span style="color:#E1E4E8">.m </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> getRandomNBitInteger(n)</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#79B8FF"> True</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#E1E4E8">.a </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> bytes_to_long(os.urandom(n </span><span style="color:#F97583">&gt;&gt;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.m </span><span style="color:#6A737D"># n/8 bytes</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> math.gcd(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.a, </span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.m) </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">break</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#79B8FF"> True</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#E1E4E8">.state </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> bytes_to_long(os.urandom(n </span><span style="color:#F97583">&gt;&gt;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.m </span><span style="color:#6A737D"># n/8 bytes</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> math.gcd(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.state, </span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.m) </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">break</span></span>
<span class="line"><span style="color:#79B8FF">    self</span><span style="color:#E1E4E8">.buffer </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"></span></code></pre>
<p>This pseudo-RNG yields random bits by enumerating the bits of <code>self.state</code>, generating a new state <code>self.state = self.a * pow(self.state, 3, self.m) % self.m</code> when the bits run out.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">def</span><span style="color:#79B8FF"> next</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.buffer </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> []:</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#E1E4E8">.buffer </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">(bit) </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> bit </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> bin</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.state)[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">:].zfill(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.n)]</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#E1E4E8">.state </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.a </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> pow</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.state, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.m) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.m</span></span>
<span class="line"><span style="color:#6A737D">        #log(&#39;new state: &#39;, self.state)</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.buffer.pop(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>The pseudo-RNG is used to generate a series of coin flips. We can either gain money by guessing a coin flip correctly or lose money by guessing incorrectly. Our goal is to gain enough money to reach a <code>balance</code> of at least <code>1000000000</code>.</p>
<h3 id="solution">Solution</h3>
<p>Observe that we only need to know one bit in <code>self.state</code> before it is revealed. We will bet an amount of 1 whenever we are unsure of the next bit and an amount of our whole <code>balance</code> when we are sure. On average, our 1 bets will contribute an amount of 0 while our <code>balance</code> bets will double our balance, meaning our balance will grow exponentially.</p>
<p>For the bit that we aim to know, we focus our attention to the units bit, as it is special and can sometimes be predicted when doing these types of operations. In particular, if <code>self.m</code> is even, then <code>self.a</code> and <code>self.state</code> are guaranteed to be odd as they are relatively prime to <code>self.m</code>. When this happens, <code>self.state</code> starts out as odd, and <code>self.a * pow(self.state, 3, self.m) % self.m</code> will continue to be odd. As such, in this case we can reliably predict units bit (i.e. every 64th bit) to be a 1.</p>
<p>The script below predicts <code>head</code> (0) for all non-units bits (as it is slightly more frequent due to <a href="https://en.wikipedia.org/wiki/Benford%27s_law">Benford’s law</a>) and <code>tails</code> (1) for all units bits. We’ll rerun the script until we obtain a <code>m</code> that is even and luckily gain enough <code>balance</code> so that the bets of amount 1 are not enough to bankrupt us.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> pwn </span><span style="color:#F97583">import</span><span style="color:#F97583"> *</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">r </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> remote(</span><span style="color:#9ECBFF">&quot;52.59.124.14&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">5032</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">try</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    cnt </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#79B8FF"> True</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">64</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#79B8FF">            print</span><span style="color:#E1E4E8">((line </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> r.recvline().strip()))</span></span>
<span class="line"><span style="color:#E1E4E8">            amount </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> int</span><span style="color:#E1E4E8">(line[line.find(</span><span style="color:#F97583">b</span><span style="color:#9ECBFF">&quot;(you have &quot;</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">:line.find(</span><span style="color:#F97583">b</span><span style="color:#9ECBFF">&quot;)&quot;</span><span style="color:#E1E4E8">)])</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 63</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">                r.sendline(</span><span style="color:#F97583">b</span><span style="color:#9ECBFF">&quot;1&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">                print</span><span style="color:#E1E4E8">(r.recvline())</span></span>
<span class="line"><span style="color:#E1E4E8">                r.sendline(</span><span style="color:#F97583">b</span><span style="color:#9ECBFF">&quot;head&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">            else</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">                r.sendline(</span><span style="color:#79B8FF">bytes</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(amount), </span><span style="color:#9ECBFF">&quot;utf-8&quot;</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#79B8FF">                print</span><span style="color:#E1E4E8">(r.recvline())</span></span>
<span class="line"><span style="color:#E1E4E8">                r.sendline(</span><span style="color:#F97583">b</span><span style="color:#9ECBFF">&quot;tails&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">            print</span><span style="color:#E1E4E8">(line </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> r.recvline().strip())</span></span>
<span class="line"><span style="color:#E1E4E8">            win </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> line </span><span style="color:#F97583">==</span><span style="color:#F97583"> b</span><span style="color:#9ECBFF">&quot;you win&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">            cnt </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#F97583">except</span><span style="color:#79B8FF"> Exception</span><span style="color:#F97583"> as</span><span style="color:#E1E4E8"> e:</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#79B8FF"> True</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(r.recvline())</span></span>
<span class="line"></span></code></pre>
<p>Flag: <code>ENO{1nfin1t3_r1che5_3re_y0ur5_1t_s33m5}</code></p> </div>  </main> <footer data-astro-cid-sckkx6r4>
&mdash;
<a href="https://github.com/gopherhackumn/website" target="_blank" rel="noopener" data-astro-cid-sckkx6r4>Website source</a>
&mdash;
</footer> </div> </section> </body></html> 