<!DOCTYPE html><html lang="en" data-astro-cid-sckkx6r4> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.1.9"><title>GopherHack</title><link rel="stylesheet" href="/_astro/poster.B_Cpo-Oc.css">
<link rel="stylesheet" href="/_astro/_name_.B51i_3Fs.css">
<link rel="stylesheet" href="/_astro/_post_.aVDCQf0I.css"></head> <body data-astro-cid-sckkx6r4> <section class="mainSection" data-astro-cid-sckkx6r4> <div class="content" data-astro-cid-sckkx6r4> <header data-astro-cid-sckkx6r4> <div data-astro-cid-sckkx6r4> <!-- left --> <a href="/" id="logo" data-astro-cid-sckkx6r4>
&#x1F6A9; GopherHack</a> </div> <div data-astro-cid-sckkx6r4> <!-- right --> <div class="links" data-astro-cid-sckkx6r4> <a href="/pages/contests" data-astro-cid-sckkx6r4>Contests</a> <a href="/pages/blog" data-astro-cid-sckkx6r4>Blog</a> <a href="/pages/resources" data-astro-cid-sckkx6r4>Resources</a> <a href="/pages/officers" data-astro-cid-sckkx6r4>Officers</a> </div> <div class="buttons" data-astro-cid-sckkx6r4></div> </div> </header> <main data-astro-cid-sckkx6r4>  <h1 data-astro-cid-quoef3qp>  TUCTF 2025: Liber-Tea Hero </h1> <div class="metadata" data-astro-cid-quoef3qp> <div title="2025-01-28T08:39:06.459Z" data-astro-cid-quoef3qp> Tuesday, January 28, 2025 </div> <div data-astro-cid-quoef3qp>
Authored by <a href="/authors/dajeff">dajeff</a> </div> <div data-astro-cid-quoef3qp>
CTF:  <a href="/pages/contests#ctftime-2584" data-astro-cid-quoef3qp> TUCTF 2024 </a> </div> <div data-astro-cid-quoef3qp>Tags: misc</div> </div> <div class="postContent" data-astro-cid-quoef3qp> <link rel="stylesheet" href="/_astro/styles.YnPl4Our.css"/>
<blockquote>
<p>Hey there diver! You haven’t completed your annual strategem training yet! You want to be mince meat for the enemies of managed democracy? I didn’t think so. Hop to it, or I’ll be speaking with your Democracy Officer!</p>
<p><a href="https://liber-tea-hero.tuctf.com">https://liber-tea-hero.tuctf.com</a></p>
</blockquote>
<p>The URL leads to a website with content similar to the screenshot below. Pressing WASD or the arrow keys displays that an input is either <span class="correct">correct</span> or <span class="incorrect">incorrect</span>.</p>
<p align="center"><img src="/_astro/website.D_eHRHpb.png" alt="Screenshot of https://alien-interference.tuctf.com" width="80%"/></p>
<p><a href="https://discord.com/channels/1308853321959870515/1308854880282218538/1332847258219315270">A Discord message</a> notes that we need a score of 250 to get the flag.</p>
<p>Viewing the page source, we find the logic that controls the input result in <a href="https://liber-tea-hero.tuctf.com/static/controls.js"><code>controls.js</code></a>. The code sends a message to a <code>WebSocket</code> with a time limit. We can guess that we should input the correct sequence of key presses in order to pass the “current level”. We also guess that each image displayed corresponds to a fixed sequence of key presses.</p>
<p>We can easily send requests to a <code>WebSocket</code> through the Javascript console, so we will write a script to quickly brute force every image given.</p>
<p>In order to answer queries quickly, we keep an object <code>d</code> (for dictionary) with the key presses needed for each image.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> d </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // ...</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;data:image/webp;base64,UklGRpwDAABXRUJQVlA4TJADAAAv/8A/APfBKJIkRVV9zOf2fN+XxgbbSJKc3Mz/oyEB8jcJCZMYtGAUSZKirtrdY7Jz/i3dD+c/iGwjAAUqAsMfDQAAGlUpzukQZaD8QSz1rNKvtxP1TLfj3qgCAFFRfdURCAQCIwBRAkFUmyv2qv077d8M36zmyz5t2lz1VadJxTosoppUCAQBAEGU4F4O2QqeuNaTgqK17W3bBiITxu52mr0026JtdqJSWbj/+4IJavz80a3/+7+I/k9AOPv/7P8zHD9/mUjqxSbzfKk4Fa4X+DQ4NOtT4NCty+fQrkvn0K/L5tCwS+bQscvl0LJL5dCzy+TQtEvkUPDdAkR5HIV39fLpdgGiNI7C25/0Ql4VIMriKORn6sXMrgrgkjgKaWaqsTsFcDkchXdMPcYCuBSOQpqCjAVwGRyFNBUZC+ASOAppSrI7BfDTcxTeMTUZC0SlKcooEU1VRnloyrI70twxdRlloSnMKAlNZUY5aEqzO1LcMbXt9fMQbSSHaMeoOhuy0UP2v26+ffR7RcwAZC1JLBd9AsCFhZbk/vJv7ttvtdC0WbfeMRWT3h3m2itGV19LdvMt0p634IGuvYq/au7e4n06+Nun9w4E3MSNH/f3eQw1sVy8SkdsXB4CwHf72//UPXvXpxPkOz/A94pyMp30FvP9/KCjBy+ZhCQf6Kpl55vXSdzXdG+poz/6JDZdR0n0vy/I+P/WQvFQKB4Kxf8tJ+c/t0LxUCgeCsVn/539908zds0sm3nHIXozy2becYjezLKZd5ycKBu6tsmcXSp0NpmzS4XOJnN2aWoihOu7NqP3JfQ2o/cl9Daj91MTIR1W161S8eq6VSpeXbdKExMhHy4zSyMtszTSMksTEzEFfcYxzDiGGScmYhLwMMDTaA/wNNoDPE1LxEQgIO0xIO0xIE1LxGQ8xz6eYx/PMS0R0yGiRBGVF1F5EUr7WowIkedbubYcgBQOqSkVQ6EQDsFfSOSh+LMIEbL30jDoeyELg8YvN3JsLaj81oX1MmztwnWWP5HAgvLfnJqHCtyeUh/qcH4y/SJU44vTeB5qstsdXx/qsvX17rj6RajMpmX3/Jieh0p9dyxvQ70++3AMu6ehZi9/Oty6C1V76+Lyw2F2Xcu6yefb/b17Fip5vi8PFd3v4+dQ14t+zMevUFnAL2VPQ41374fMQ5W37paZO+ts1rB7nEBvm1mdnf1/9v//uQc=&quot;</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#9ECBFF">        &quot;down&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &quot;left&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &quot;down&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &quot;down&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &quot;up&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        &quot;left&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    ],</span></span>
<span class="line"><span style="color:#6A737D">    // ...</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span></code></pre>
<p>To construct this <code>d</code> by brute forcing images, we’ll first find the first direction at index <code>i = 0</code> by brute forcing each direction <code>directions[di]</code> for <code>di = 0</code> to <code>3</code>, then find the second direction at index <code>i = 1</code>, and so on. We’ll store the correct directions we’ve accumulated in a list <code>l</code>.</p>
<p>Let’s first define these variables and a couple of constants.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> directions</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">&#39;left&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;up&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;right&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;down&#39;</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> t</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// Timeout used to avoid race conditions</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> l </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> di </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> guess </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;  </span><span style="color:#6A737D">// Indicates if a new guess should be made. Used to avoid race conditions</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> con </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;  </span><span style="color:#6A737D">// Used to stop the brute force</span></span></code></pre>
<p>When we run the following <code>bruteforce</code> function, which sends the next direction(s) to try, we send the list of directions recorded in <code>d</code> if it exists. Otherwise, we send all the currently recorded directions <code>l[i]</code>, then try new directions <code>directions[di]</code>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> bruteforce</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // Setting con = false in the console allows us to stop the brute force at any time</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (con) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (cur </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> d) {</span></span>
<span class="line"><span style="color:#E1E4E8">            l </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            guess </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">const</span><span style="color:#79B8FF"> x</span><span style="color:#F97583"> of</span><span style="color:#E1E4E8"> d[cur]) {</span></span>
<span class="line"><span style="color:#B392F0">                sendMessage</span><span style="color:#E1E4E8">(x);</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8"> l.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#B392F0">            sendMessage</span><span style="color:#E1E4E8">(l[i]);</span></span>
<span class="line"><span style="color:#E1E4E8">        } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">            sendMessage</span><span style="color:#E1E4E8">(directions[di]);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>When we receive a message, we’ll want to call this <code>bruteforce</code> function again to send the next guess. If the message is incorrect, then we need to resend the recorded sequence of correct directions (i.e. reset <code>i = 0</code>), then guess the next possible direction (i.e. increment <code>di</code>).</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">typeof</span><span style="color:#E1E4E8"> message.data </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> &quot;string&quot;</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#E1E4E8"> message.data.</span><span style="color:#B392F0">trim</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> &#39;false&#39;</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    di </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (di </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">%</span><span style="color:#E1E4E8"> directions.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (l </span><span style="color:#F97583">!==</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#B392F0">        bruteforce</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>If the message is correct, we can add <code>directions[di]</code> to our accumulated list <code>l</code>, increment <code>i</code>, and reset <code>di = 0</code>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">else</span><span style="color:#F97583"> if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">typeof</span><span style="color:#E1E4E8"> message.data </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> &quot;string&quot;</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#E1E4E8"> message.data.</span><span style="color:#B392F0">trim</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> &#39;true&#39;</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (guess) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">&gt;=</span><span style="color:#E1E4E8"> l.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">            l.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(directions[di]);</span></span>
<span class="line"><span style="color:#E1E4E8">            di </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        i </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (l </span><span style="color:#F97583">!==</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#B392F0">            bruteforce</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>If a new image appears, we’ll add <code>l</code> to our dictionary, reset our variables, wait a little bit to avoid any possible race conditions from other requests, then run <code>bruteforce</code> on the next image.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">else</span><span style="color:#F97583"> if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">typeof</span><span style="color:#E1E4E8"> message.data </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> &quot;object&quot;</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> imgElement</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> document.</span><span style="color:#B392F0">getElementById</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#39;dynamic-image&#39;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> base64img</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> convertBlobToBase64</span><span style="color:#E1E4E8">(message.data);</span></span>
<span class="line"><span style="color:#E1E4E8">    imgElement.src </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> &#39;data:image/webp;base64,&#39;</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> base64img;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">(cur </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> d)) {</span></span>
<span class="line"><span style="color:#E1E4E8">        d[cur] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">l];</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    cur </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> imgElement.src;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    l </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    di </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    setTimeout</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        l </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#B392F0">        bruteforce</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }, t);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>And that’s it! Modifying <code>console.js</code> to include these bits of code and copying and pasting it into the console runs our brute force at a speed fast enough to get the flag within a few minutes or so.</p>
<p>Flag: <code>TUCTF{4_S00p3r_3aRtH_3xP3rT}</code></p>
<p>The final solve script can be found <a href="/_astro/solve.BFs8FhrF.js">here</a>. We pre-fill <code>d</code> with entries gathered (copied and pasted) from previous runs to make the code run faster.</p>
<p>I recommend checking out other writeups, such as <a href="https://discord.com/channels/1308853321959870515/1308854880282218538/1333155195911143596">this Discord message by <code>fr0j</code></a>, for scripts written in other languages (e.g. Python 3). Join the <a href="https://discord.gg/kUeFHD8Y">TUCTF Discord</a> for access.
d</p> </div>  </main> <footer data-astro-cid-sckkx6r4>
&mdash;
<a href="https://github.com/gopherhackumn/website" target="_blank" rel="noopener" data-astro-cid-sckkx6r4>Website source</a>
&mdash;
</footer> </div> </section> </body></html> 