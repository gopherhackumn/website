<!DOCTYPE html><html lang="en" data-astro-cid-sckkx6r4> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.0.3"><title>GopherHack</title><style>@font-face{font-family:Monaspace Neon;font-style:normal;font-display:swap;font-weight:400;src:url(/_astro/monaspace-neon-latin-400-normal.BZtV1wRa.woff2) format("woff2"),url(/_astro/monaspace-neon-latin-400-normal.DVFelWsN.woff) format("woff")}
@font-face{font-family:Public Sans Variable;font-style:normal;font-display:swap;font-weight:100 900;src:url(/_astro/public-sans-vietnamese-wght-normal.CtlIRbEm.woff2) format("woff2-variations");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:Public Sans Variable;font-style:normal;font-display:swap;font-weight:100 900;src:url(/_astro/public-sans-latin-ext-wght-normal.DMdr36yP.woff2) format("woff2-variations");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Public Sans Variable;font-style:normal;font-display:swap;font-weight:100 900;src:url(/_astro/public-sans-latin-wght-normal.DdeTHZLK.woff2) format("woff2-variations");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}html,body{margin:0;width:100%;height:100%;box-sizing:border-box;color:#beb7a2;background-color:#000;font-size:1.05rem;font-family:Public Sans Variable,sans-serif;line-height:1.5;h1,h2,h3,h4,h5,h6{font-family:Monaspace Neon,monospace;color:#ffde7a}a{color:#d63d61}@media (max-width: 640px){padding-left:1rem;padding-right:1rem}}.mainSection[data-astro-cid-sckkx6r4]{max-width:48rem;margin-left:auto;margin-right:auto}footer[data-astro-cid-sckkx6r4]{margin-top:8rem;text-align:center;margin-bottom:4rem}.content[data-astro-cid-sckkx6r4]{display:flex;height:100%;flex-direction:column;header{display:flex;align-items:center;justify-content:space-between;padding-bottom:2.5rem;padding-top:2.5rem;#logo{font-size:2rem;color:#ffde7a;text-decoration:none;font-family:Monaspace Neon,monospace}@media (max-width: 640px){flex-direction:column}}.links{display:flex;gap:1rem}}
.draft[data-astro-cid-quoef3qp]{color:#ff0}.metadata[data-astro-cid-quoef3qp]{font-size:90%;color:#ffffff80}
[data-astro-image]{width:100%;height:auto;object-fit:var(--fit);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body data-astro-cid-sckkx6r4> <section class="mainSection" data-astro-cid-sckkx6r4> <div class="content" data-astro-cid-sckkx6r4> <header data-astro-cid-sckkx6r4> <div data-astro-cid-sckkx6r4> <!-- left --> <a href="/" id="logo" data-astro-cid-sckkx6r4>
&#x1F6A9; GopherHack</a> </div> <div data-astro-cid-sckkx6r4> <!-- right --> <div class="links" data-astro-cid-sckkx6r4> <a href="/pages/contests" data-astro-cid-sckkx6r4>Contests</a> <a href="/pages/blog" data-astro-cid-sckkx6r4>Blog</a> <a href="/pages/resources" data-astro-cid-sckkx6r4>Resources</a> <a href="/pages/officers" data-astro-cid-sckkx6r4>Officers</a> </div> <div class="buttons" data-astro-cid-sckkx6r4></div> </div> </header> <main data-astro-cid-sckkx6r4>  <h1 data-astro-cid-quoef3qp>  TUCTF 2025: Simpler Cipher </h1> <div class="metadata" data-astro-cid-quoef3qp> <div title="2025-01-27T06:35:25.235Z" data-astro-cid-quoef3qp> Monday, January 27, 2025 </div> <div data-astro-cid-quoef3qp>
Authored by <a href="/authors/michael">michael</a> </div> <div data-astro-cid-quoef3qp>
CTF:  <a href="/pages/contests#ctftime-2584" data-astro-cid-quoef3qp> TUCTF 2024 </a> </div> </div> <p>For the challenge, we are given <a href="/_astro/cipher.QZ-bymXo.py">this file</a>.
Unlike typical crypto server challenges, this code does an unusual conversion to binary form.</p>
<p>The encryption algorithm requires 2 pieces we don’t know:</p>
<ol>
<li>a secret key, which is 6 bytes long</li>
<li>the conversion tables, <code>exptables</code>, found at the top of the file</li>
</ol>
<p>The algorithm “encrypts” the flag by first running a conversion step by taking
every 4 bits and converting it to 6 bits through a lookup table. Then, it XORs
this result against the key in 6-byte chunks. Since the lookup table is unique,
decryption is the reverse process; first it XORs the given ciphertext, then
reverses the lookup.</p>
<p>Here is the conversion process, called “expand”:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="py"><code><span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> expand</span><span style="color:#E1E4E8">(ctext):</span></span>
<span class="line"><span style="color:#E1E4E8">    ct</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;&#39;</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">len</span><span style="color:#E1E4E8">(ctext),</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#E1E4E8">        msb </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ctext[i:i</span><span style="color:#F97583">+</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">        lsb </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ctext[i</span><span style="color:#F97583">+</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">:i</span><span style="color:#F97583">+</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">        exp </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> exptables[</span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">(msb,</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">)][</span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">(lsb,</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">)]</span></span>
<span class="line"><span style="color:#E1E4E8">        ct</span><span style="color:#F97583">+=</span><span style="color:#E1E4E8">exp</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> ct</span></span>
<span class="line"></span></code></pre>
<p><code>ctext</code> here is a string of either <code>&quot;1&quot;</code> or <code>&quot;0&quot;</code>. As we can see, the 4 bits are
broken down into two pieces of 2 bits each, which are treated as indices in a
two-level lookup table.</p>
<p>Since the challenge server provides us with an encryption oracle, we can brute
force the unknown tables by using a predictable key. For example, the plaintext
<code>&quot;AAAAAA&quot;</code> and the key <code>&quot;AAAAAA&quot;</code> should cancel out, leaving us with all zeroes
entering the conversion step. This reveals to us what the combination (0, 0)
maps to in the lookup table.</p>
<p>Using this logic, we can write a function to create a string that enumerates all
the possible lookup keys. I chose to vary the keys rather than the string. This means I had to ask the encryption oracle for the corresponding ciphertexts of two strings:</p>
<ul>
<li><code>40620426c8ea</code></li>
<li><code>8cae41414141</code></li>
</ul>
<p>The 41414141 at the end is there because there’s only 64 bits of combinations,
so I padded it to be a multiple of 48 bits (the key size).</p>
<p>After asking the server for the ciphertexts, I got:</p>
<ul>
<li><code>010101011001101101110011010001000101100001111000101000011110011101101110</code></li>
<li><code>111100110001010010101010010101010101010101010101010101010101010101010101</code></li>
</ul>
<p>Now I can break these into 6-bit chunks and build the lookup tables.</p>
<p>Finally, I know the flag format begins with <code>TUCTF{</code>. So I simply brute-forced
each character of the key until I found it (honestly this could probably have
been done in a more direct way but this way was faster).</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="py"><code><span class="line"><span style="color:#E1E4E8">flagkey </span><span style="color:#F97583">=</span><span style="color:#F97583"> b</span><span style="color:#9ECBFF">&quot;AAAAAA&quot;</span></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i, c </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> enumerate</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">b</span><span style="color:#9ECBFF">&quot;TUCTF{&quot;</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">256</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#E1E4E8">        newflagkey </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> list</span><span style="color:#E1E4E8">(flagkey)</span></span>
<span class="line"><span style="color:#E1E4E8">        newflagkey[i] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> j</span></span>
<span class="line"><span style="color:#E1E4E8">        newflagkey </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> bytes</span><span style="color:#E1E4E8">(newflagkey)</span></span>
<span class="line"><span style="color:#E1E4E8">        flagptxt </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> decode(flagctxt, newflagkey)</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> flagptxt[i] </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> c:</span></span>
<span class="line"><span style="color:#E1E4E8">            flagkey </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> newflagkey</span></span>
<span class="line"><span style="color:#F97583">            break</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(c)</span></span>
<span class="line"></span></code></pre>
<p>Using this key with the flag that the server gives us reveals the final flag, <code>TUCTF{tr@ck_th3_exp@nsi0ns_and_r3v3rs3}</code>.</p>
<p>My final solve script can be found <a href="data:application/octet-stream;base64,I0ZpcnN0IGRlY29kZSB0aGUgdGFibGUKCnB0eHQgPSBiIkFBQUFBQSIKCmtleWJhc2UgPSBiIkFBQUFBQSIKCmRlZiB0b2JpbihiKTogcmV0dXJuICIiLmpvaW4oInswOjA4Yn0iLmZvcm1hdChpKSBmb3IgaSBpbiBiKQpkZWYgeG9yKGEsIGIpOiByZXR1cm4gIiIuam9pbihzdHIoaW50KGMpIF4gaW50KGQpKSBmb3IgYywgZCBpbiB6aXAoYSwgYikpCmRlZiBmcm9tYmluKGIpOiByZXR1cm4gaW50KGIsIDIpLnRvX2J5dGVzKChsZW4oYikgKyA3KSAvLyA4LCBieXRlb3JkZXI9ImJpZyIpCgprZXliYXNlYmluID0gdG9iaW4oa2V5YmFzZSkKCnRkZXNpcmVkID0gIiIKZm9yIG1zYiBpbiByYW5nZSg0KToKICAgIGZvciBsc2IgaW4gcmFuZ2UoNCk6CiAgICAgICAgZGVzaXJlZCA9ICJ7MDowMmJ9Ii5mb3JtYXQobXNiKSArICJ7MDowMmJ9Ii5mb3JtYXQobHNiKQogICAgICAgIHByaW50KG1zYiwgbHNiLCBkZXNpcmVkKQogICAgICAgIHRkZXNpcmVkICs9IGRlc2lyZWQKCnRkZXNpcmVkMiA9IHRkZXNpcmVkICsgIjAiICogKDQ4IC0gbGVuKHRkZXNpcmVkKSAlIDQ4KQpwcmludChmcm9tYmluKGtleWJhc2ViaW4pKQoKZm9yIGkgaW4gcmFuZ2UoMCwgbGVuKHRkZXNpcmVkMiksIDQ4KToKICAgIHNlZyA9IHRkZXNpcmVkMltpOmkrNDhdCiAgICBzZWcgPSB4b3Ioc2VnLCBrZXliYXNlYmluKQogICAgcHJpbnQoYnl0ZXMuaGV4KGZyb21iaW4oc2VnKSkpCgpyZXN1bHRzID0gWwogICAgIjAxMDEwMTAxMTAwMTEwMTEwMTExMDAxMTAxMDAwMTAwMDEwMTEwMDAwMTExMTAwMDEwMTAwMDAxMTExMDAxMTEwMTEwMTExMCIsCiAgICAiMTExMTAwMTEwMDAxMDEwMDEwMTAxMDEwMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxIiwKXQoKcmVzdWx0ID0gKHJlc3VsdHNbMF0gKyByZXN1bHRzWzFdKVs6bGVuKHRkZXNpcmVkKSAqIDMgLy8gMl0KcHJpbnQobGVuKHJlc3VsdCksIHJlc3VsdCkKCmV4cHRhYmxlID0ge30KcmV2ZXhwdGFibGUgPSB7fQpjdXIgPSAwCmZvciBtc2IgaW4gcmFuZ2UoNCk6CiAgICBmb3IgbHNiIGluIHJhbmdlKDQpOgogICAgICAgIHJlcyA9IHJlc3VsdFtjdXI6Y3VyKzZdCiAgICAgICAgZXhwdGFibGVbbXNiLCBsc2JdID0gcmVzCiAgICAgICAgcmV2ZXhwdGFibGVbcmVzXSA9IChtc2IsIGxzYikKICAgICAgICAjIHByaW50KHJlcykKICAgICAgICBjdXIgKz0gNgoKcHJpbnQoZXhwdGFibGUpCgojIERlY29kZQoKaW1wb3J0IHNlY3JldHMKcmFuZGtleSA9IGInXHgxZDlceDhlXHgxYVx4YmZNJyAjIHNlY3JldHMudG9rZW5fYnl0ZXMoNikKcHJpbnQocmFuZGtleSwgYnl0ZXMuaGV4KHJhbmRrZXkpKQoKZGVmIGRlY29kZShjdHh0LCBrZXkpOgogICAga2V5YmluID0gdG9iaW4oa2V5KQoKICAgIHJlcyA9ICIiCiAgICBmb3IgaSBpbiByYW5nZSgwLCBsZW4oY3R4dCksIDYpOgogICAgICAgIHNlZyA9IGN0eHRbaTppKzZdCiAgICAgICAgbXNiLCBsc2IgPSByZXZleHB0YWJsZVtzZWddCiAgICAgICAgbXNibHNiID0gInswOjAyYn0iLmZvcm1hdChtc2IpICsgInswOjAyYn0iLmZvcm1hdChsc2IpCiAgICAgICAgcmVzICs9IG1zYmxzYgoKICAgIHB0eHQgPSAiIgogICAgZm9yIGkgaW4gcmFuZ2UoMCwgbGVuKHJlcyksIDQ4KToKICAgICAgICBzZWcgPSByZXNbaTppKzQ4XQogICAgICAgIHB0eHQgKz0geG9yKHNlZywga2V5YmluKQoKICAgIHJldHVybiBmcm9tYmluKHB0eHQpCgpjdHh0ID0gIjAwMDEwMTAwMDEwMTAwMDEwMTExMTEwMDAxMDAxMDEwMTEwMTExMTAwMDEwMDAwMTExMDAwMTAxMDEwMTEwMDAwMTAxMTAwMTExMDAxMTExMDAwMTAxMDAwMTAxMDAxMDAxMDAxMDAxMTAwMTEwMDAwMTEwMTAwMDExMDAwMTExMDAxMTEwMTEwMTAxMTExMDExMDAxMTExMTEwMDAxMTAwMTAxMTExMDAxMDAxMDExMDAxMTExMTAwMDEwMTAxMDExMDAwMTAxMDEwMTExMDAxMTAxMTEwMSIKCnByaW50KGRlY29kZShjdHh0LCByYW5ka2V5KSkKCiMgRmxhZwoKZmxhZ2N0eHQgPSAiMTExMTAwMDEwMDAxMDEwMDAxMTAxMDAwMDAwMTAxMTEwMDAxMDEwMDAxMTAwMDAxMTAwMDAxMTAwMDAxMDAwMTAxMTAxMDEwMDEwMDEwMDEwMDAxMTAwMDAxMTAxMDEwMDAwMTAxMDEwMDEwMTExMDAwMDExMDAxMDEwMDAxMTAxMTEwMTExMDAwMTAxMTEwMDEwMDEwMDEwMDAxMTExMDAwMDAwMTAxMTAxMTAxMTEwMDAxMDEwMDAxMTEwMDAxMDEwMDAxMDAwMTAxMDAwMTAxMTExMTAwMDEwMDEwMDEwMTAxMDAwMTAxMTEwMDAxMTExMDAwMDEwMTAxMTAwMDAxMDExMDAxMDEwMDAxMDExMTEwMDExMDAxMDEwMDAxMTAxMDEwMDEwMDEwMTAwMDAxMDEwMDEwMDEwMDAxMDExMDAxMTExMDAwMTEwMDExMDEwMDAxMDEwMDEwMDEwMDAxMDEwMTAxMTExMTAwMTAxMDEwMTAwMDAxMTAxMDEwMTAxMTAxMTEwMDAxMTAwMDAxMDEwMDAxMDExMDAxMTEwMDExMDAwMTAxMTAwMDAxMDEwMDEwMTEwMDExMTAxMTAxMDEwMDEwMTAwMDAxMTEwMDExMDExMDAxMTAxMTAxMTAxMTAxMDExMDAxMTAxMTAxMTAwMDAxIgoKIyBQcm9iYWJseSBzdGFydHMgd2l0aCBUVUNURgpmbGFna2V5ID0gYiJBQUFBQUEiCmZvciBpLCBjIGluIGVudW1lcmF0ZShiIlRVQ1RGeyIpOgogICAgZm9yIGogaW4gcmFuZ2UoMjU2KToKICAgICAgICBuZXdmbGFna2V5ID0gbGlzdChmbGFna2V5KQogICAgICAgIG5ld2ZsYWdrZXlbaV0gPSBqCiAgICAgICAgbmV3ZmxhZ2tleSA9IGJ5dGVzKG5ld2ZsYWdrZXkpCiAgICAgICAgZmxhZ3B0eHQgPSBkZWNvZGUoZmxhZ2N0eHQsIG5ld2ZsYWdrZXkpCiAgICAgICAgaWYgZmxhZ3B0eHRbaV0gPT0gYzoKICAgICAgICAgICAgZmxhZ2tleSA9IG5ld2ZsYWdrZXkKICAgICAgICAgICAgYnJlYWsKICAgIHByaW50KGMpCgpwcmludChmbGFna2V5KQpwcmludChkZWNvZGUoZmxhZ2N0eHQsIGZsYWdrZXkpKQoKCg==">here</a>.</p>  </main> <footer data-astro-cid-sckkx6r4>
&mdash;
<a href="https://github.com/gopherhackumn/website" target="_blank" rel="noopener" data-astro-cid-sckkx6r4>Website source</a>
&mdash;
</footer> </div> </section> </body></html> 